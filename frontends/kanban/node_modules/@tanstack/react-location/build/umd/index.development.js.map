{"version":3,"file":"index.development.js","sources":["../../src/qss.ts","../../src/index.tsx"],"sourcesContent":["// @ts-nocheck\n\n// We're inlining qss here for compression's sake, but we've included it as a hard dependency for the MIT license it requires.\n\nexport function encode(obj, pfx?: string) {\n  var k,\n    i,\n    tmp,\n    str = ''\n\n  for (k in obj) {\n    if ((tmp = obj[k]) !== void 0) {\n      if (Array.isArray(tmp)) {\n        for (i = 0; i < tmp.length; i++) {\n          str && (str += '&')\n          str += encodeURIComponent(k) + '=' + encodeURIComponent(tmp[i])\n        }\n      } else {\n        str && (str += '&')\n        str += encodeURIComponent(k) + '=' + encodeURIComponent(tmp)\n      }\n    }\n  }\n\n  return (pfx || '') + str\n}\n\nfunction toValue(mix) {\n  if (!mix) return ''\n  var str = decodeURIComponent(mix)\n  if (str === 'false') return false\n  if (str === 'true') return true\n  return +str * 0 === 0 ? +str : str\n}\n\nexport function decode(str) {\n  var tmp,\n    k,\n    out = {},\n    arr = str.split('&')\n\n  while ((tmp = arr.shift())) {\n    tmp = tmp.split('=')\n    k = tmp.shift()\n    if (out[k] !== void 0) {\n      out[k] = [].concat(out[k], toValue(tmp.shift()))\n    } else {\n      out[k] = toValue(tmp.shift())\n    }\n  }\n\n  return out\n}\n","import * as React from 'react'\n\nimport {\n  createHashHistory,\n  createBrowserHistory,\n  createMemoryHistory,\n  BrowserHistory,\n  MemoryHistory,\n  History,\n  HashHistory,\n} from 'history'\n\nexport { createHashHistory, createBrowserHistory, createMemoryHistory }\n\nimport { decode, encode } from './qss'\n\n// Types\n\ntype Timeout = ReturnType<typeof setTimeout>\n\ntype Maybe<T, TUnknown> = T extends {} ? T : TUnknown\n\nexport type DefaultGenerics = {\n  LoaderData: LoaderData<unknown>\n  Params: Params<string>\n  Search: Search<unknown>\n  RouteMeta: RouteMeta<unknown>\n}\n\nexport type PartialGenerics = Partial<DefaultGenerics>\n\nexport type MakeGenerics<TGenerics extends PartialGenerics> = TGenerics\n\nexport type Search<T> = Record<string, T>\nexport type Params<T> = Record<string, T>\nexport type LoaderData<T> = Record<string, T>\nexport type RouteMeta<T> = Record<string, T>\n\nexport type UseGeneric<\n  TGenerics extends PartialGenerics,\n  TGeneric extends keyof PartialGenerics,\n> = TGeneric extends 'LoaderData' | 'Search'\n  ? Partial<Maybe<TGenerics[TGeneric], DefaultGenerics[TGeneric]>>\n  : Maybe<TGenerics[TGeneric], DefaultGenerics[TGeneric]>\n\nexport type ReactLocationOptions = {\n  // The history object to be used internally by react-location\n  // A history will be created automatically if not provided.\n  history?: BrowserHistory | MemoryHistory | HashHistory\n  stringifySearch?: SearchSerializer\n  parseSearch?: SearchParser\n}\n\nexport type SearchSerializer = (searchObj: Record<string, any>) => string\nexport type SearchParser = (searchStr: string) => Record<string, any>\n\nexport type Updater<TResult> = TResult | ((prev?: TResult) => TResult)\n\nexport type Location<TGenerics extends PartialGenerics = DefaultGenerics> = {\n  href: string\n  pathname: string\n  search: UseGeneric<TGenerics, 'Search'>\n  searchStr: string\n  hash: string\n  key?: string\n  // nextAction?: 'push' | 'replace'\n}\n\nexport type Route<TGenerics extends PartialGenerics = DefaultGenerics> = {\n  // The path to match (relative to the nearest parent `Route` component or root basepath)\n  path?: string\n  // An ID to uniquely identify this route within its siblings. This is only required for routes that *only match on search* or if you have multiple routes with the same path\n  id?: string\n  // If true, this route will be matched as case-sensitive\n  caseSensitive?: boolean\n  // Either (1) an object that will be used to shallowly match the current location's search or (2) A function that receives the current search params and can return truthy if they are matched.\n  search?: SearchPredicate<UseGeneric<TGenerics, 'Search'>>\n  // The duration to wait during `loader` execution before showing the `pendingElement`\n  pendingMs?: number\n  // _If the `pendingElement` is shown_, the minimum duration for which it will be visible.\n  pendingMinMs?: number\n  // Search filters can be used to rewrite, persist, default and manipulate search params for link that\n  // point to their routes or child routes. See the \"basic\" example to see them in action.\n  searchFilters?: SearchFilter<TGenerics>[]\n  // An array of child routes\n  children?: Route<TGenerics>[]\n  // Route Loaders (see below) can be inline on the route, or resolved async\n} & RouteLoaders<TGenerics> & {\n    // If `import` is defined, this route can resolve its elements and loaders in a single asynchronous call\n    // This is particularly useful for code-splitting or module federation\n    import?: (opts: {\n      params: UseGeneric<TGenerics, 'Params'>\n      search: UseGeneric<TGenerics, 'Search'>\n    }) => Promise<RouteLoaders<TGenerics>>\n  }\n\nexport type RouteLoaders<TGenerics> = {\n  // The content to be rendered when the route is matched. If no element is provided, defaults to `<Outlet />`\n  element?: SyncOrAsyncElement<TGenerics>\n  // The content to be rendered when `loader` encounters an error\n  errorElement?: SyncOrAsyncElement<TGenerics>\n  // The content to be rendered when the duration of `loader` execution surpasses the `pendingMs` duration\n  pendingElement?: SyncOrAsyncElement<TGenerics>\n  // An asynchronous function responsible for preparing or fetching data for the route before it is rendered\n  loader?: LoaderFn<TGenerics>\n  // An asynchronous function responsible for cleaning up when the match cache is cleared. This is useful when\n  // the loader function has side effects that need to be cleaned up when the match is no longer in use.\n  unloader?: UnloaderFn<TGenerics>\n  // An integer of milliseconds representing how long data should be cached for the route\n  loaderMaxAge?: number\n  // Similar to React's useEffect hook, this function is called\n  // when moving from an inactive state to an active one. Likewise, when moving from\n  // an active to an inactive state, the return function (if provided) is called.\n  onMatch?: (\n    match: RouteMatch<TGenerics>,\n  ) => void | undefined | ((match: RouteMatch<TGenerics>) => void)\n  // This function is called when the route remains active from one transition to the next.\n  onTransition?: (match: RouteMatch<TGenerics>) => void\n  // An object of whatever you want! This object is accessible anywhere matches are.\n  meta?: UseGeneric<TGenerics, 'RouteMeta'>\n}\n\nexport type SearchFilter<TGenerics> = (\n  prev: UseGeneric<TGenerics, 'Search'>,\n) => UseGeneric<TGenerics, 'Search'>\n\nexport type MatchLocation<TGenerics extends PartialGenerics = DefaultGenerics> =\n  {\n    to?: string | number | null\n    search?: SearchPredicate<UseGeneric<TGenerics, 'Search'>>\n    fuzzy?: boolean\n    caseSensitive?: boolean\n  }\n\nexport type SearchPredicate<TSearch> = (search: TSearch) => any\n\nexport type SyncOrAsyncElement<\n  TGenerics extends PartialGenerics = DefaultGenerics,\n> = React.ReactNode | AsyncElement<TGenerics>\n\nexport type AsyncElement<TGenerics extends PartialGenerics = DefaultGenerics> =\n  (opts: {\n    params: UseGeneric<TGenerics, 'Params'>\n  }) => Promise<React.ReactNode>\n\nexport type UnloadedMatch<TGenerics extends PartialGenerics = DefaultGenerics> =\n  {\n    id: string\n    route: Route<TGenerics>\n    pathname: string\n    params: UseGeneric<TGenerics, 'Params'>\n    search: UseGeneric<TGenerics, 'Search'>\n  }\n\nexport type LoaderFn<TGenerics extends PartialGenerics = DefaultGenerics> = (\n  routeMatch: RouteMatch<TGenerics>,\n  opts: LoaderFnOptions<TGenerics>,\n) => PromiseLike<UseGeneric<TGenerics, 'LoaderData'>>\n\nexport type UnloaderFn<TGenerics extends PartialGenerics = DefaultGenerics> = (\n  routeMatch: RouteMatch<TGenerics>,\n) => void\n\nexport type LoaderFnOptions<\n  TGenerics extends PartialGenerics = DefaultGenerics,\n> = {\n  parentMatch?: RouteMatch<TGenerics>\n  dispatch: (event: LoaderDispatchEvent<TGenerics>) => void\n}\n\ntype PromiseLike<T> = Promise<T> | T\n\nexport type ListenerFn = () => void\n\nexport type Segment = {\n  type: 'pathname' | 'param' | 'wildcard'\n  value: string\n}\n\nexport type RouterProps<TGenerics extends PartialGenerics = DefaultGenerics> = {\n  // Children will default to `<Outlet />` if not provided\n  children?: React.ReactNode\n  location: ReactLocation<TGenerics>\n} & RouterOptions<TGenerics>\n\nexport type RouterOptions<TGenerics> = {\n  // An array of route objects to match\n  routes: Route<TGenerics>[]\n  basepath?: string\n  filterRoutes?: FilterRoutesFn\n  defaultLinkPreloadMaxAge?: number\n  defaultLoaderMaxAge?: number\n  useErrorBoundary?: boolean\n  defaultElement?: SyncOrAsyncElement<TGenerics>\n  defaultErrorElement?: SyncOrAsyncElement<TGenerics>\n  defaultPendingElement?: SyncOrAsyncElement<TGenerics>\n  defaultPendingMs?: number\n  defaultPendingMinMs?: number\n  caseSensitive?: boolean\n  __experimental__snapshot?: __Experimental__RouterSnapshot<TGenerics>\n}\n\nexport type __Experimental__RouterSnapshot<TGenerics> = {\n  // matches: Partial<RouteMatch<TGenerics>>[]\n  location: Location<TGenerics>\n  matches: SnapshotRouteMatch<TGenerics>[]\n}\n\nexport type SnapshotRouteMatch<TGenerics> = {\n  id: string\n  ownData: UseGeneric<TGenerics, 'LoaderData'>\n}\n\nexport type BuildNextOptions<\n  TGenerics extends PartialGenerics = DefaultGenerics,\n> = {\n  to?: string | number | null\n  search?: true | Updater<UseGeneric<TGenerics, 'Search'>>\n  hash?: true | Updater<string>\n  from?: Partial<Location<TGenerics>>\n  key?: string\n  __searchFilters?: SearchFilter<TGenerics>[]\n}\n\nexport type NavigateOptions<TGenerics> = BuildNextOptions<TGenerics> & {\n  replace?: boolean\n  fromCurrent?: boolean\n}\n\nexport type PromptProps = {\n  message: string\n  when?: boolean | any\n  children?: React.ReactNode\n}\n\nexport type LinkProps<TGenerics extends PartialGenerics = DefaultGenerics> =\n  Omit<React.AnchorHTMLAttributes<HTMLAnchorElement>, 'href' | 'children'> & {\n    // The absolute or relative destination pathname\n    to?: string | number | null\n    // The new search object or a function to update it\n    search?: true | Updater<UseGeneric<TGenerics, 'Search'>>\n    // The new has string or a function to update it\n    hash?: Updater<string>\n    // Whether to replace the current history stack instead of pushing a new one\n    replace?: boolean\n    // A function that is passed the [Location API](#location-api) and returns additional props for the `active` state of this link. These props override other props passed to the link (`style`'s are merged, `className`'s are concatenated)\n    getActiveProps?: () => Record<string, any>\n    // A function that is passed the [Location API](#location-api) and returns additional props for the `inactive` state of this link. These props override other props passed to the link (`style`'s are merged, `className`'s are concatenated)\n    getInactiveProps?: () => Record<string, any>\n    // Defaults to `{ exact: false, includeHash: false }`\n    activeOptions?: ActiveOptions\n    // If set, will preload the linked route on hover and cache it for this many milliseconds in hopes that the user will eventually navigate there.\n    preload?: number\n    // If true, will render the link without the href attribute\n    disabled?: boolean\n    // A custom ref prop because of this: https://stackoverflow.com/questions/58469229/react-with-typescript-generics-while-using-react-forwardref/58473012\n    _ref?: React.Ref<HTMLAnchorElement>\n    // If a function is pass as a child, it will be given the `isActive` boolean to aid in further styling on the element it returns\n    children?:\n      | React.ReactNode\n      | ((state: { isActive: boolean }) => React.ReactNode)\n  }\n\ntype ActiveOptions = {\n  exact?: boolean\n  includeHash?: boolean\n}\n\nexport type LinkPropsType<TGenerics extends PartialGenerics = DefaultGenerics> =\n  LinkProps<TGenerics>\n\nexport type LoaderDispatchEvent<\n  TGenerics extends PartialGenerics = DefaultGenerics,\n> =\n  | {\n      type: 'maxAge'\n      maxAge: number\n    }\n  | {\n      type: 'loading'\n    }\n  | {\n      type: 'resolve'\n      data: UseGeneric<TGenerics, 'LoaderData'>\n    }\n  | {\n      type: 'reject'\n      error: unknown\n    }\n\nexport type LoadRouteFn<TGenerics> = (\n  next: Location<TGenerics>,\n) => MatchLoader<TGenerics>\n\nexport type TransitionState<TGenerics> = {\n  location: Location<TGenerics>\n  matches: RouteMatch<TGenerics>[]\n}\n\nexport type FilterRoutesFn = <\n  TGenerics extends PartialGenerics = DefaultGenerics,\n>(\n  routes: Route<TGenerics>[],\n) => Route<TGenerics>[]\n\nexport type RouterPropsType<\n  TGenerics extends PartialGenerics = DefaultGenerics,\n> = RouterProps<TGenerics>\n\nexport type RouterType<TGenerics extends PartialGenerics = DefaultGenerics> = (\n  props: RouterProps<TGenerics>,\n) => JSX.Element\n\ntype Listener = () => void\n\n// Source\n\nconst LocationContext = React.createContext<{ location: ReactLocation<any> }>(\n  null!,\n)\nconst MatchesContext = React.createContext<RouteMatch<any>[]>(null!)\nconst routerContext = React.createContext<{ router: RouterInstance<any> }>(\n  null!,\n)\n\n// Detect if we're in the DOM\nconst isDOM = Boolean(\n  typeof window !== 'undefined' &&\n    window.document &&\n    window.document.createElement,\n)\n\nconst useLayoutEffect = isDOM ? React.useLayoutEffect : React.useEffect\n\n// This is the default history object if none is defined\nconst createDefaultHistory = () =>\n  isDOM ? createBrowserHistory() : createMemoryHistory()\n\nclass Subscribable {\n  listeners: Listener[]\n\n  constructor() {\n    this.listeners = []\n  }\n\n  subscribe(listener: Listener): () => void {\n    this.listeners.push(listener as Listener)\n\n    return () => {\n      this.listeners = this.listeners.filter((x) => x !== listener)\n    }\n  }\n\n  notify(): void {\n    this.listeners.forEach((listener) => listener())\n  }\n}\n\nexport class ReactLocation<\n  TGenerics extends PartialGenerics = DefaultGenerics,\n> extends Subscribable {\n  history: BrowserHistory | MemoryHistory\n  stringifySearch: SearchSerializer\n  parseSearch: SearchParser\n\n  current: Location<TGenerics>\n  destroy: () => void\n  navigateTimeout?: Timeout\n  nextAction?: 'push' | 'replace'\n\n  //\n\n  isTransitioning: boolean = false\n\n  constructor(options?: ReactLocationOptions) {\n    super()\n    this.history = options?.history || createDefaultHistory()\n    this.stringifySearch = options?.stringifySearch ?? defaultStringifySearch\n    this.parseSearch = options?.parseSearch ?? defaultParseSearch\n\n    this.current = this.parseLocation(this.history.location)\n\n    this.destroy = this.history.listen((event) => {\n      this.current = this.parseLocation(event.location, this.current)\n      this.notify()\n    })\n  }\n\n  buildNext(\n    basepath: string = '/',\n    dest: BuildNextOptions<TGenerics> = {},\n  ): Location<TGenerics> {\n    const from = {\n      ...this.current,\n      ...dest.from,\n    }\n\n    const pathname = resolvePath(basepath, from.pathname, `${dest.to ?? '.'}`)\n\n    const filteredSearch = dest.__searchFilters?.length\n      ? dest.__searchFilters.reduce((prev, next) => next(prev), from.search)\n      : from.search\n\n    const updatedSearch =\n      dest.search === true\n        ? filteredSearch // Preserve from true\n        : dest.search\n        ? functionalUpdate(dest.search, filteredSearch) ?? {} // Updater\n        : dest.__searchFilters?.length\n        ? filteredSearch // Preserve from filters\n        : {}\n\n    const search = replaceEqualDeep(from.search, updatedSearch)\n\n    const searchStr = this.stringifySearch(search)\n    let hash =\n      dest.hash === true ? from.hash : functionalUpdate(dest.hash, from.hash)\n    hash = hash ? `#${hash}` : ''\n\n    return {\n      pathname,\n      search,\n      searchStr,\n      hash,\n      href: `${pathname}${searchStr}${hash}`,\n      key: dest.key,\n    }\n  }\n\n  navigate(next: Location<TGenerics>, replace?: boolean): void {\n    this.current = next\n\n    if (this.navigateTimeout) clearTimeout(this.navigateTimeout)\n\n    let nextAction: 'push' | 'replace' = 'replace'\n\n    if (!replace) {\n      nextAction = 'push'\n    }\n\n    const isSameUrl =\n      this.parseLocation(this.history.location).href === this.current.href\n\n    if (isSameUrl && !this.current.key) {\n      nextAction = 'replace'\n    }\n\n    if (nextAction === 'replace') {\n      return this.history.replace({\n        pathname: this.current.pathname,\n        hash: this.current.hash,\n        search: this.current.searchStr,\n      })\n    }\n\n    return this.history.push({\n      pathname: this.current.pathname,\n      hash: this.current.hash,\n      search: this.current.searchStr,\n    })\n  }\n\n  parseLocation(\n    location: History['location'],\n    previousLocation?: Location<TGenerics>,\n  ): Location<TGenerics> {\n    const parsedSearch = this.parseSearch(location.search)\n\n    return {\n      pathname: location.pathname,\n      searchStr: location.search,\n      search: replaceEqualDeep(previousLocation?.search, parsedSearch),\n      hash: location.hash.split('#').reverse()[0] ?? '',\n      href: `${location.pathname}${location.search}${location.hash}`,\n      key: location.key,\n    }\n  }\n}\n\nexport type MatchesProviderProps<TGenerics> = {\n  value: RouteMatch<TGenerics>[]\n  children: React.ReactNode\n}\n\nexport function MatchesProvider<TGenerics>(\n  props: MatchesProviderProps<TGenerics>,\n) {\n  return <MatchesContext.Provider {...props} />\n}\n\nexport function Router<TGenerics extends PartialGenerics = DefaultGenerics>({\n  children,\n  location,\n  __experimental__snapshot,\n  ...rest\n}: RouterProps<TGenerics>) {\n  const routerRef = React.useRef<RouterInstance<TGenerics>>(null!)\n  if (!routerRef.current) {\n    routerRef.current = new RouterInstance<TGenerics>({\n      location,\n      __experimental__snapshot,\n      routes: rest.routes,\n    })\n  }\n  const router = routerRef.current\n\n  const [nonce, rerender] = React.useReducer(() => ({}), {})\n\n  router.update(rest)\n\n  useLayoutEffect(() => {\n    return router.subscribe(() => {\n      rerender()\n    })\n  }, [])\n\n  useLayoutEffect(() => {\n    return router.updateLocation(location.current).unsubscribe\n  }, [location.current.key])\n\n  return (\n    <LocationContext.Provider value={{ location }}>\n      <routerContext.Provider value={{ router }}>\n        <InitialSideEffects />\n        <MatchesProvider value={[router.rootMatch!, ...router.state.matches]}>\n          {children ?? <Outlet />}\n        </MatchesProvider>\n      </routerContext.Provider>\n    </LocationContext.Provider>\n  )\n}\n\nfunction InitialSideEffects() {\n  const location = useLocation()\n  const buildNext = useBuildNext()\n  const navigate = useNavigate()\n\n  useLayoutEffect(() => {\n    const next = buildNext({\n      to: '.',\n      search: true,\n      hash: true,\n    })\n\n    if (next.href !== location.current.href) {\n      navigate({\n        to: '.',\n        search: true,\n        hash: true,\n        fromCurrent: true,\n        replace: true,\n      })\n    }\n  }, [])\n\n  return null\n}\n\ntype RouterInstanceState<TGenerics> = {\n  state: TransitionState<TGenerics>\n  pending?: TransitionState<TGenerics>\n}\n\nexport class RouterInstance<\n  TGenerics extends PartialGenerics = DefaultGenerics,\n> extends Subscribable {\n  basepath?: string\n  rootMatch?: RouteMatch<TGenerics>\n  state: TransitionState<TGenerics>\n  pending?: TransitionState<TGenerics>\n  routes!: Route<TGenerics>[]\n  filterRoutes?: FilterRoutesFn\n  defaultLinkPreloadMaxAge?: number\n  defaultLoaderMaxAge?: number\n  useErrorBoundary?: boolean\n  defaultElement: SyncOrAsyncElement<TGenerics>\n  defaultErrorElement: SyncOrAsyncElement<TGenerics>\n  defaultPendingElement: SyncOrAsyncElement<TGenerics>\n  defaultPendingMs?: number\n  defaultPendingMinMs?: number\n  caseSensitive?: boolean\n\n  routesById: Record<string, Route<TGenerics>> = {}\n\n  constructor({\n    location,\n    __experimental__snapshot,\n    ...rest\n  }: {\n    location: ReactLocation<TGenerics>\n    __experimental__snapshot?: __Experimental__RouterSnapshot<TGenerics>\n  } & RouterOptions<TGenerics>) {\n    super()\n\n    this.update(rest)\n\n    let matches: RouteMatch<TGenerics>[] = []\n\n    if (__experimental__snapshot) {\n      const matchLoader = new MatchLoader(this, location.current)\n      matchLoader.matches.forEach((match, index) => {\n        if (match.id !== __experimental__snapshot.matches[index]?.id) {\n          throw new Error(\n            `Router hydration mismatch: ${match.id} !== ${__experimental__snapshot.matches[index]?.id}`,\n          )\n        }\n        match.ownData = __experimental__snapshot.matches[index]?.ownData ?? {}\n      })\n      cascadeMatchData(matchLoader.matches)\n\n      matches = matchLoader.matches\n    }\n\n    this.state = {\n      location: __experimental__snapshot?.location ?? location.current,\n      matches: matches,\n    }\n\n    location.subscribe(() => this.notify())\n  }\n\n  update = ({ basepath, routes, ...opts }: RouterOptions<TGenerics>) => {\n    Object.assign(this, opts)\n\n    this.basepath = cleanPath(`/${basepath ?? ''}`)\n\n    this.routesById = {}\n\n    const recurseRoutes = (\n      routes: Route<TGenerics>[],\n      parent?: Route<TGenerics>,\n    ): Route<TGenerics>[] => {\n      return routes.map((route) => {\n        const path = route.path ?? '*'\n\n        const id = joinPaths([\n          parent?.id === 'root' ? '' : parent?.id,\n          `${path?.replace(/(.)\\/$/, '$1')}${route.id ? `-${route.id}` : ''}`,\n        ])\n\n        route = {\n          ...route,\n          pendingMs: route.pendingMs ?? opts?.defaultPendingMs,\n          pendingMinMs: route.pendingMinMs ?? opts?.defaultPendingMinMs,\n          id,\n        }\n\n        if (this.routesById[id]) {\n          if (process.env.NODE_ENV !== 'production') {\n            console.warn(\n              `Duplicate routes found with id: ${id}`,\n              this.routesById,\n              route,\n            )\n          }\n          throw new Error()\n        }\n\n        this.routesById[id] = route\n\n        route.children = route.children?.length\n          ? recurseRoutes(route.children, route)\n          : undefined\n\n        return route\n      })\n    }\n\n    this.routes = recurseRoutes(routes)\n\n    this.rootMatch = {\n      id: 'root',\n      params: {} as any,\n      search: {} as any,\n      pathname: this.basepath,\n      route: null!,\n      ownData: {},\n      data: {},\n      isLoading: false,\n      status: 'resolved',\n    }\n  }\n\n  setState = (\n    updater: (\n      old: RouterInstanceState<TGenerics>,\n    ) => RouterInstanceState<TGenerics>,\n  ) => {\n    const newState = updater({ state: this.state, pending: this.pending })\n    this.state = newState.state\n    this.pending = newState.pending\n    this.cleanMatchCache()\n    this.notify()\n  }\n\n  matchCache: Record<string, RouteMatch<TGenerics>> = {}\n\n  cleanMatchCache = () => {\n    const activeMatchIds = [\n      ...(this?.state.matches ?? []),\n      ...(this?.pending?.matches ?? []),\n    ].map((d) => d.id)\n\n    Object.values(this.matchCache).forEach((match) => {\n      if (!match.updatedAt) {\n        return\n      }\n\n      if (activeMatchIds.includes(match.id)) {\n        return\n      }\n\n      const age = Date.now() - (match.updatedAt ?? 0)\n\n      if (!match.maxAge || age > match.maxAge) {\n        if (match.route.unloader) {\n          match.route.unloader(match)\n        }\n\n        delete this.matchCache[match.id]\n      }\n    })\n  }\n\n  updateLocation = (next: Location<TGenerics>) => {\n    let unsubscribe: () => void\n\n    const promise = new Promise<void>((resolve) => {\n      const matchLoader = new MatchLoader(this, next)\n\n      this.setState((old) => {\n        return {\n          ...old,\n          pending: {\n            location: matchLoader.location,\n            matches: matchLoader.matches,\n          },\n        }\n      })\n\n      unsubscribe = matchLoader.subscribe(() => {\n        const currentMatches = this.state.matches\n\n        currentMatches\n          .filter((d) => {\n            return !matchLoader.matches.find((dd) => dd.id === d.id)\n          })\n          .forEach((d) => {\n            d.onExit?.(d)\n          })\n\n        currentMatches\n          .filter((d) => {\n            return matchLoader.matches.find((dd) => dd.id === d.id)\n          })\n          .forEach((d) => {\n            d.route.onTransition?.(d)\n          })\n\n        matchLoader.matches\n          .filter((d) => {\n            return !currentMatches.find((dd) => dd.id === d.id)\n          })\n          .forEach((d) => {\n            d.onExit = d.route.onMatch?.(d)\n          })\n\n        this.setState((old) => {\n          return {\n            ...old,\n            state: {\n              location: matchLoader.location,\n              matches: matchLoader.matches,\n            },\n            pending: undefined,\n          }\n        })\n\n        resolve()\n      })\n\n      matchLoader.loadData()\n      matchLoader.startPending()\n    })\n\n    return {\n      promise,\n      unsubscribe: unsubscribe!,\n    }\n  }\n\n  __experimental__createSnapshot =\n    (): __Experimental__RouterSnapshot<TGenerics> => {\n      return {\n        location: this.state.location,\n        matches: this.state.matches.map(({ ownData, id }) => {\n          return {\n            id,\n            ownData,\n          }\n        }),\n      }\n    }\n}\n\nexport type UseLocationType<\n  TGenerics extends PartialGenerics = DefaultGenerics,\n> = () => ReactLocation<TGenerics>\n\nexport function useLocation<\n  TGenerics extends PartialGenerics = DefaultGenerics,\n>(): ReactLocation<TGenerics> {\n  const context = React.useContext(LocationContext) as {\n    location: ReactLocation<TGenerics>\n  }\n  warning(!!context, 'useLocation must be used within a <ReactLocation />')\n\n  return context.location\n}\n\nexport class RouteMatch<TGenerics extends PartialGenerics = DefaultGenerics> {\n  id!: string\n  route!: Route<TGenerics>\n  pathname!: string\n  params!: UseGeneric<TGenerics, 'Params'>\n  search!: UseGeneric<TGenerics, 'Search'>\n  updatedAt?: number\n  element?: React.ReactNode\n  errorElement?: React.ReactNode\n  pendingElement?: React.ReactNode\n  error?: unknown\n  loaderPromise?: Promise<UseGeneric<TGenerics, 'LoaderData'>>\n  maxAge?: number\n  matchLoader?: MatchLoader<TGenerics>\n  pendingTimeout?: Timeout\n  pendingMinPromise?: Promise<void>\n  onExit?: void | ((match: RouteMatch<TGenerics>) => void)\n\n  constructor(unloadedMatch: UnloadedMatch<TGenerics>) {\n    Object.assign(this, unloadedMatch)\n  }\n\n  status: 'loading' | 'pending' | 'resolved' | 'rejected' = 'loading'\n  ownData: UseGeneric<TGenerics, 'LoaderData'> = {}\n  data: UseGeneric<TGenerics, 'LoaderData'> = {}\n  isLoading: boolean = false\n\n  private notify? = (isSoft?: boolean) => {\n    this.matchLoader?.preNotify(isSoft ? this : undefined)\n  }\n\n  assignMatchLoader? = (matchLoader: MatchLoader<TGenerics>) => {\n    this.matchLoader = matchLoader\n  }\n\n  startPending? = () => {\n    if (this.pendingTimeout) {\n      clearTimeout(this.pendingTimeout)\n    }\n\n    if (this.route.pendingMs !== undefined) {\n      this.pendingTimeout = setTimeout(() => {\n        if (this.status === 'loading') {\n          this.status = 'pending'\n        }\n        this.notify?.()\n        if (typeof this.route.pendingMinMs !== 'undefined') {\n          this.pendingMinPromise = new Promise((r) =>\n            setTimeout(r, this.route.pendingMinMs),\n          )\n        }\n      }, this.route.pendingMs)\n    }\n  }\n\n  load? = (opts: {\n    maxAge?: number\n    parentMatch?: RouteMatch<TGenerics>\n    router: RouterInstance<TGenerics>\n  }) => {\n    this.maxAge =\n      opts.maxAge ?? this.route.loaderMaxAge ?? opts.router.defaultLoaderMaxAge\n\n    if (this.loaderPromise) {\n      return\n    }\n\n    const importer = this.route.import\n\n    // First, run any importers\n    this.loaderPromise = (\n      !importer\n        ? Promise.resolve()\n        : (() => {\n            this.isLoading = true\n            return importer({ params: this.params, search: this.search }).then(\n              (imported) => {\n                this.route = {\n                  ...this.route,\n                  ...imported,\n                }\n              },\n            )\n          })()\n    )\n      // then run all element and data loaders in parallel\n      .then(() => {\n        const elementPromises: Promise<void>[] = []\n\n        // For each element type, potentially load it asynchronously\n        const elementTypes = [\n          'element',\n          'errorElement',\n          'pendingElement',\n        ] as const\n\n        elementTypes.forEach((type) => {\n          const routeElement = this.route[type]\n\n          if (this[type]) {\n            return\n          }\n\n          if (typeof routeElement === 'function') {\n            this.isLoading = true\n            elementPromises.push(\n              (routeElement as AsyncElement)(this).then((res) => {\n                this[type] = res\n              }),\n            )\n          } else {\n            this[type] = this.route[type]\n          }\n        })\n\n        const loader = this.route.loader\n\n        const dataPromise = !loader\n          ? Promise.resolve()\n          : new Promise(async (resolveLoader) => {\n              this.isLoading = true\n\n              const loaderReady = (status: 'resolved' | 'rejected') => {\n                this.updatedAt = Date.now()\n                resolveLoader(this.ownData)\n                this.status = status\n              }\n\n              const resolve = (data: any) => {\n                this.ownData = data\n                this.error = undefined\n                loaderReady('resolved')\n              }\n\n              const reject = (err: any) => {\n                console.error(err)\n                this.error = err\n                loaderReady('rejected')\n              }\n\n              try {\n                resolve(\n                  await loader(this, {\n                    parentMatch: opts.parentMatch,\n                    dispatch: async (event) => {\n                      if (event.type === 'resolve') {\n                        resolve(event.data)\n                      } else if (event.type === 'reject') {\n                        reject(event.error)\n                      } else if (event.type === 'loading') {\n                        this.isLoading = true\n                      } else if (event.type === 'maxAge') {\n                        this.maxAge = event.maxAge\n                      }\n\n                      this.updatedAt = Date.now()\n                      this.notify?.(true)\n                    },\n                  }),\n                )\n              } catch (err) {\n                reject(err)\n              }\n            })\n\n        return Promise.all([...elementPromises, dataPromise])\n          .then(() => {\n            this.status = 'resolved'\n            this.isLoading = false\n            this.startPending = undefined\n          })\n          .then(() => this.pendingMinPromise)\n          .then(() => {\n            if (this.pendingTimeout) {\n              clearTimeout(this.pendingTimeout)\n            }\n            this.notify?.(true)\n          })\n      })\n      .then(() => {\n        return this.ownData\n      })\n  }\n}\n\nclass MatchLoader<\n  TGenerics extends PartialGenerics = DefaultGenerics,\n> extends Subscribable {\n  router: RouterInstance<TGenerics>\n  location: Location<TGenerics>\n  matches: RouteMatch<TGenerics>[]\n  prepPromise?: Promise<void>\n  matchPromise?: Promise<UnloadedMatch<TGenerics>[]>\n  firstRenderPromises?: Promise<any>[]\n  preNotifiedMatches: RouteMatch<TGenerics>[] = []\n\n  constructor(\n    router: RouterInstance<TGenerics>,\n    nextLocation: Location<TGenerics>,\n  ) {\n    super()\n    this.router = router\n    this.location = nextLocation\n    this.matches = []\n\n    const unloadedMatches = matchRoutes(this.router, this.location)\n\n    this.matches = unloadedMatches?.map(\n      (unloadedMatch): RouteMatch<TGenerics> => {\n        if (!this.router.matchCache[unloadedMatch.id]) {\n          this.router.matchCache[unloadedMatch.id] = new RouteMatch(\n            unloadedMatch,\n          )\n        }\n\n        return this.router.matchCache[unloadedMatch.id]!\n      },\n    )\n  }\n\n  status: 'pending' | 'resolved' = 'pending'\n\n  preNotify = (routeMatch?: RouteMatch<TGenerics>) => {\n    if (routeMatch) {\n      if (!this.preNotifiedMatches.includes(routeMatch)) {\n        this.preNotifiedMatches.push(routeMatch)\n      }\n    }\n\n    if (!routeMatch || this.preNotifiedMatches.length === this.matches.length) {\n      this.status = 'resolved'\n      cascadeMatchData(this.matches)\n      this.notify()\n    }\n  }\n\n  loadData = async ({ maxAge }: { maxAge?: number } = {}) => {\n    this.router.cleanMatchCache()\n\n    if (!this.matches?.length) {\n      this.preNotify()\n      return\n    }\n\n    this.firstRenderPromises = []\n\n    this.matches.forEach((match, index) => {\n      const parentMatch = this.matches?.[index - 1]\n      match.assignMatchLoader?.(this)\n      match.load?.({ maxAge, parentMatch, router: this.router })\n      this.firstRenderPromises?.push(match.loaderPromise!)\n    })\n\n    return await Promise.all(this.firstRenderPromises).then(() => {\n      this.preNotify()\n      return this.matches\n    })\n  }\n\n  load = async ({ maxAge }: { maxAge?: number } = {}) => {\n    return await this.loadData({ maxAge })\n  }\n\n  startPending = async () => {\n    this.matches.forEach((match) => match.startPending?.())\n  }\n}\n\nfunction cascadeMatchData<TGenerics>(matches?: RouteMatch<TGenerics>[]) {\n  matches?.forEach((match, index) => {\n    const parentMatch = matches?.[index - 1]\n\n    match.data = {\n      ...(parentMatch?.data ?? ({} as any)),\n      ...match.ownData,\n    }\n  })\n}\n\nexport type UseRouterType<TGenerics extends PartialGenerics = DefaultGenerics> =\n  () => RouterInstance<TGenerics>\n\nexport function useRouter<\n  TGenerics extends PartialGenerics = DefaultGenerics,\n>(): RouterInstance<TGenerics> {\n  const value = React.useContext(routerContext)\n  if (!value) {\n    warning(true, 'You are trying to use useRouter() outside of ReactLocation!')\n    throw new Error()\n  }\n\n  return value.router as RouterInstance<TGenerics>\n}\n\nexport interface MatchRoutesOptions<TGenerics> {\n  filterRoutes?: FilterRoutesFn\n  defaultPendingMs?: number\n  defaultPendingMinMs?: number\n  defaultElement?: SyncOrAsyncElement<TGenerics>\n  defaultErrorElement?: SyncOrAsyncElement<TGenerics>\n  defaultPendingElement?: SyncOrAsyncElement<TGenerics>\n}\n\nexport type MatchRoutesType<\n  TGenerics extends PartialGenerics = DefaultGenerics,\n> = (\n  router: RouterInstance<TGenerics>[],\n  currentLocation: Location<TGenerics>,\n) => Promise<UnloadedMatch<TGenerics>[]>\n\nexport function matchRoutes<\n  TGenerics extends PartialGenerics = DefaultGenerics,\n>(\n  router: RouterInstance<TGenerics>,\n  currentLocation: Location<TGenerics>,\n): UnloadedMatch<TGenerics>[] {\n  if (!router.routes.length) {\n    return []\n  }\n\n  const matches: UnloadedMatch<TGenerics>[] = []\n\n  const recurse = async (\n    routes: Route<TGenerics>[],\n    parentMatch: UnloadedMatch<TGenerics>,\n  ): Promise<void> => {\n    let { pathname, params } = parentMatch\n    const filteredRoutes = router?.filterRoutes\n      ? router?.filterRoutes(routes)\n      : routes\n\n    const route = filteredRoutes.find((route) => {\n      const fullRoutePathName = joinPaths([pathname, route.path])\n\n      const fuzzy = !!(route.path !== '/' || route.children?.length)\n\n      const matchParams = matchRoute(currentLocation, {\n        to: fullRoutePathName,\n        search: route.search,\n        fuzzy,\n        caseSensitive: route.caseSensitive ?? router.caseSensitive,\n      })\n\n      if (matchParams) {\n        params = {\n          ...params,\n          ...matchParams,\n        }\n      }\n\n      return !!matchParams\n    })\n\n    if (!route) {\n      return\n    }\n\n    const interpolatedPath = interpolatePath(route.path, params)\n    pathname = joinPaths([pathname, interpolatedPath])\n\n    const interpolatedId = interpolatePath(route.id, params, true)\n\n    const match: UnloadedMatch<TGenerics> = {\n      id: interpolatedId,\n      route,\n      params,\n      pathname,\n      search: currentLocation.search,\n    }\n\n    matches.push(match)\n\n    if (route.children?.length) {\n      recurse(route.children, match)\n    }\n  }\n\n  recurse(router.routes, router.rootMatch!)\n\n  return matches\n}\n\nfunction interpolatePath(\n  path: string | undefined,\n  params: any,\n  leaveWildcard?: boolean,\n) {\n  const interpolatedPathSegments = parsePathname(path)\n\n  return joinPaths(\n    interpolatedPathSegments.map((segment) => {\n      if (segment.value === '*' && !leaveWildcard) {\n        return ''\n      }\n\n      if (segment.type === 'param') {\n        return params![segment.value.substring(1)] ?? ''\n      }\n\n      return segment.value\n    }),\n  )\n}\n\nexport type UseLoadRouteType<\n  TGenerics extends PartialGenerics = DefaultGenerics,\n> = (routes?: Route<TGenerics>[]) => void\n\nexport function useLoadRoute<\n  TGenerics extends PartialGenerics = DefaultGenerics,\n>() {\n  const location = useLocation<TGenerics>()\n  const match = useMatch<TGenerics>()\n  const router = useRouter<TGenerics>()\n  const buildNext = useBuildNext<TGenerics>()\n\n  return useLatestCallback(\n    async (\n      navigate: NavigateOptions<TGenerics> = location.current,\n      opts?: { maxAge?: number },\n    ) => {\n      const next = buildNext({\n        ...navigate,\n        from: navigate.from ?? { pathname: match.pathname },\n      })\n\n      const matchLoader = new MatchLoader(router, next)\n\n      return await matchLoader.load(opts)\n    },\n  )\n}\n\nexport type UseMatchesType<\n  TGenerics extends PartialGenerics = DefaultGenerics,\n> = () => RouteMatch<TGenerics>[]\n\nexport function useParentMatches<\n  TGenerics extends PartialGenerics = DefaultGenerics,\n>(): RouteMatch<TGenerics>[] {\n  const router = useRouter<TGenerics>()\n  const match = useMatch()\n\n  const matches = router.state.matches\n\n  return matches.slice(0, matches.findIndex((d) => d.id === match.id) - 1)\n}\n\nexport function useMatches<\n  TGenerics extends PartialGenerics = DefaultGenerics,\n>(): RouteMatch<TGenerics>[] {\n  return React.useContext(MatchesContext)\n}\n\nexport type UseMatchType<TGenerics extends PartialGenerics = DefaultGenerics> =\n  () => RouteMatch<TGenerics>\n\nexport function useMatch<\n  TGenerics extends PartialGenerics = DefaultGenerics,\n>(): RouteMatch<TGenerics> {\n  return useMatches<TGenerics>()?.[0]!\n}\n\nexport type UseNavigateType<\n  TGenerics extends PartialGenerics = DefaultGenerics,\n> = (options: NavigateOptions<TGenerics>) => void\n\nexport function useNavigate<\n  TGenerics extends PartialGenerics = DefaultGenerics,\n>() {\n  const location = useLocation<TGenerics>()\n  const match = useMatch<TGenerics>()\n  const buildNext = useBuildNext<TGenerics>()\n\n  function navigate({\n    search,\n    hash,\n    replace,\n    from,\n    to,\n    fromCurrent,\n  }: NavigateOptions<TGenerics> & {\n    replace?: boolean\n  }) {\n    fromCurrent = fromCurrent ?? typeof to === 'undefined'\n\n    const next = buildNext({\n      to,\n      search,\n      hash,\n      from: fromCurrent\n        ? location.current\n        : from ?? { pathname: match.pathname },\n    })\n\n    location.navigate(next, replace)\n  }\n\n  return useLatestCallback(navigate)\n}\n\nexport type NavigateType<TGenerics extends PartialGenerics = DefaultGenerics> =\n  (options: NavigateOptions<TGenerics>) => null\n\nexport function Navigate<TGenerics extends PartialGenerics = DefaultGenerics>(\n  options: NavigateOptions<TGenerics>,\n) {\n  let navigate = useNavigate<TGenerics>()\n\n  useLayoutEffect(() => {\n    navigate(options)\n  }, [navigate])\n\n  return null\n}\n\nfunction useBuildNext<TGenerics>() {\n  const location = useLocation<TGenerics>()\n  const router = useRouter<TGenerics>()\n\n  const buildNext = (opts: BuildNextOptions<TGenerics>) => {\n    const next = location.buildNext(router.basepath, opts)\n\n    const matches = matchRoutes<TGenerics>(router, next)\n\n    const __searchFilters = matches\n      .map((match) => match.route.searchFilters ?? [])\n      .flat()\n      .filter(Boolean)\n\n    return location.buildNext(router.basepath, { ...opts, __searchFilters })\n  }\n\n  return useLatestCallback(buildNext)\n}\n\nexport type LinkType<TGenerics extends PartialGenerics = DefaultGenerics> = (\n  props: LinkProps<TGenerics>,\n) => JSX.Element\n\nexport const Link = function Link<\n  TGenerics extends PartialGenerics = DefaultGenerics,\n>({\n  to = '.',\n  search,\n  hash,\n  children,\n  target,\n  style = {},\n  replace,\n  onClick,\n  onMouseEnter,\n  className = '',\n  getActiveProps = () => ({ className: 'active' }),\n  getInactiveProps = () => ({}),\n  activeOptions,\n  preload,\n  disabled,\n  _ref,\n  ...rest\n}: LinkProps<TGenerics>) {\n  const loadRoute = useLoadRoute<TGenerics>()\n  const match = useMatch<TGenerics>()\n  const location = useLocation<TGenerics>()\n  const router = useRouter<TGenerics>()\n  const navigate = useNavigate<TGenerics>()\n  const buildNext = useBuildNext<TGenerics>()\n\n  preload = preload ?? router.defaultLinkPreloadMaxAge\n\n  // If this `to` is a valid external URL, log a warning\n  try {\n    const url = new URL(`${to}`)\n    warning(\n      false,\n      `<Link /> should not be used for external URLs like: ${url.href}`,\n    )\n  } catch (e) {}\n\n  const next = buildNext({\n    to,\n    search,\n    hash,\n    from: { pathname: match.pathname },\n  })\n\n  // The click handler\n  const handleClick = (e: React.MouseEvent<HTMLAnchorElement>) => {\n    if (disabled) return\n    if (onClick) onClick(e)\n\n    if (\n      !isCtrlEvent(e) &&\n      !e.defaultPrevented &&\n      (!target || target === '_self') &&\n      e.button === 0\n    ) {\n      e.preventDefault()\n      // All is well? Navigate!\n      navigate({\n        to,\n        search,\n        hash,\n        replace,\n        from: { pathname: match.pathname },\n      })\n    }\n  }\n\n  // The click handler\n  const handleMouseEnter = (e: React.MouseEvent<HTMLAnchorElement>) => {\n    if (onMouseEnter) onMouseEnter(e)\n\n    if (preload && preload > 0) {\n      loadRoute(\n        {\n          to,\n          search,\n          hash,\n        },\n        { maxAge: preload },\n      )\n    }\n  }\n\n  // Compare path/hash for matches\n  const pathIsEqual = location.current.pathname === next.pathname\n  const currentPathSplit = location.current.pathname.split('/')\n  const nextPathSplit = next.pathname.split('/')\n  const pathIsFuzzyEqual = nextPathSplit.every(\n    (d, i) => d === currentPathSplit[i],\n  )\n  const hashIsEqual = location.current.hash === next.hash\n\n  // Combine the matches based on user options\n  const pathTest = activeOptions?.exact ? pathIsEqual : pathIsFuzzyEqual\n  const hashTest = activeOptions?.includeHash ? hashIsEqual : true\n\n  // The final \"active\" test\n  const isActive = pathTest && hashTest\n\n  // Get the active props\n  const {\n    style: activeStyle = {},\n    className: activeClassName = '',\n    ...activeRest\n  } = isActive ? getActiveProps() : {}\n\n  // Get the inactive props\n  const {\n    style: inactiveStyle = {},\n    className: inactiveClassName = '',\n    ...inactiveRest\n  } = isActive ? {} : getInactiveProps()\n\n  return (\n    <a\n      {...{\n        ref: _ref,\n        href: disabled ? undefined : next.href,\n        onClick: handleClick,\n        onMouseEnter: handleMouseEnter,\n        target,\n        style: {\n          ...style,\n          ...activeStyle,\n          ...inactiveStyle,\n        },\n        className:\n          [className, activeClassName, inactiveClassName]\n            .filter(Boolean)\n            .join(' ') || undefined,\n        ...(disabled\n          ? {\n              role: 'link',\n              'aria-disabled': true,\n            }\n          : undefined),\n        ...rest,\n        ...activeRest,\n        ...inactiveRest,\n        children:\n          typeof children === 'function' ? children({ isActive }) : children,\n      }}\n    />\n  )\n}\n\nexport function Outlet<TGenerics extends PartialGenerics = DefaultGenerics>() {\n  const router = useRouter<TGenerics>()\n  const [_, ...matches] = useMatches<TGenerics>()\n\n  const match = matches[0]\n\n  if (!match) {\n    return null\n  }\n\n  const errorElement = match.errorElement ?? router.defaultErrorElement\n\n  const element = (() => {\n    if (match.status === 'rejected') {\n      if (errorElement) {\n        return errorElement\n      }\n\n      if (!router.useErrorBoundary) {\n        if (process.env.NODE_ENV !== 'production') {\n          const preStyle: React.HTMLAttributes<HTMLPreElement>['style'] = {\n            whiteSpace: 'normal',\n            display: 'inline-block',\n            background: 'rgba(0,0,0,.1)',\n            padding: '.1rem .2rem',\n            margin: '.1rem',\n            lineHeight: '1',\n            borderRadius: '.25rem',\n          }\n\n          return (\n            <div style={{ lineHeight: '1.7' }}>\n              <strong>\n                The following error occured in the loader for you route at:{' '}\n                <pre style={preStyle}>{match.pathname}</pre>\n              </strong>\n              .\n              <br />\n              <pre\n                style={{\n                  ...preStyle,\n                  display: 'block',\n                  padding: '.5rem',\n                  borderRadius: '.5rem',\n                }}\n              >\n                {(match.error as any).toString()}\n              </pre>\n              <br />\n              Your users won't see this message in production, but they will see{' '}\n              <strong>\"An unknown error occured!\"</strong>, which is at least\n              better than breaking your entire app. ðŸ˜Š For a better UX, please\n              specify an <pre style={preStyle}>errorElement</pre> for all of\n              your routes that contain asynchronous behavior, or at least\n              provide your own\n              <pre style={preStyle}>ErrorBoundary</pre> wrapper around your\n              renders to both the elements rendered by{' '}\n              <pre style={preStyle}>\n                {'useRoutes(routes, { useErrorBoundary: true })'}\n              </pre>{' '}\n              and <pre style={preStyle}>{'<Router useErrorBoundary />'}</pre>.{' '}\n              <br />\n              <br />\n            </div>\n          )\n        }\n        return 'An unknown error occured!'\n      }\n\n      throw match.error\n    }\n\n    const pendingElement = match.pendingElement ?? router.defaultPendingElement\n\n    if (match.status === 'loading') {\n      return null\n    }\n\n    if (match.status === 'pending') {\n      if (match.route.pendingMs || pendingElement) {\n        return pendingElement ?? null\n      }\n    }\n\n    const matchElement = match.element ?? router.defaultElement\n\n    return matchElement ?? <Outlet />\n  })()\n\n  return <MatchesProvider value={matches}>{element}</MatchesProvider>\n}\n\nexport function useResolvePath<\n  TGenerics extends PartialGenerics = DefaultGenerics,\n>() {\n  const router = useRouter<TGenerics>()\n  const match = useMatch<TGenerics>()\n\n  return useLatestCallback((path: string) =>\n    resolvePath(router.basepath!, match.pathname!, cleanPath(path)),\n  )\n}\n\nexport type UseSearchType<TGenerics extends PartialGenerics = DefaultGenerics> =\n  () => Partial<Maybe<TGenerics['Search'], Search<any>>>\n\nexport function useSearch<\n  TGenerics extends PartialGenerics = DefaultGenerics,\n>() {\n  const location = useLocation<TGenerics>()\n  return location.current.search\n}\n\nexport type MatchRouteType<\n  TGenerics extends PartialGenerics = DefaultGenerics,\n> = (\n  currentLocation: Location<TGenerics>,\n  matchLocation: MatchLocation<TGenerics>,\n) => UseGeneric<TGenerics, 'Params'> | undefined\n\nexport function matchRoute<TGenerics extends PartialGenerics = DefaultGenerics>(\n  currentLocation: Location<TGenerics>,\n  matchLocation: MatchLocation<TGenerics>,\n): UseGeneric<TGenerics, 'Params'> | undefined {\n  const pathParams = matchByPath(currentLocation, matchLocation)\n  const searchMatched = matchBySearch(currentLocation, matchLocation)\n\n  if (matchLocation.to && !pathParams) {\n    return\n  }\n\n  if (matchLocation.search && !searchMatched) {\n    return\n  }\n\n  return (pathParams ?? {}) as UseGeneric<TGenerics, 'Params'>\n}\n\nexport type UseMatchRouteType<\n  TGenerics extends PartialGenerics = DefaultGenerics,\n> = () => (\n  matchLocation: MatchLocation<TGenerics>,\n) => Maybe<TGenerics['Params'], Params<any>> | undefined\n\nexport type UseMatchRouteOptions<TGenerics> = MatchLocation<TGenerics> & {\n  pending?: boolean\n}\n\nexport function useMatchRoute<\n  TGenerics extends PartialGenerics = DefaultGenerics,\n>(): (\n  matchLocation: UseMatchRouteOptions<TGenerics>,\n  opts?: { caseSensitive?: boolean },\n) => Maybe<TGenerics['Params'], Params<any>> | undefined {\n  const router = useRouter<TGenerics>()\n  const resolvePath = useResolvePath<TGenerics>()\n\n  return useLatestCallback(\n    ({\n      pending,\n      ...matchLocation\n    }: MatchLocation<TGenerics> & { pending?: boolean }) => {\n      matchLocation = {\n        ...matchLocation,\n        to: matchLocation.to ? resolvePath(`${matchLocation.to}`) : undefined,\n      }\n\n      if (pending) {\n        if (!router.pending?.location) {\n          return undefined\n        }\n        return matchRoute(router.pending.location, matchLocation)\n      }\n\n      return matchRoute(router.state.location, matchLocation)\n    },\n  )\n}\n\nexport function MatchRoute<\n  TGenerics extends PartialGenerics = DefaultGenerics,\n>({\n  children,\n  ...rest\n}: UseMatchRouteOptions<TGenerics> & {\n  children:\n    | React.ReactNode\n    | ((isNextLocation?: Params<TGenerics>) => React.ReactNode)\n}) {\n  const matchRoute = useMatchRoute<TGenerics>()\n  const match = matchRoute(rest)\n\n  if (typeof children === 'function') {\n    return children(match as any)\n  }\n\n  return match ? children : null\n}\n\nexport function usePrompt(message: string, when: boolean | any): void {\n  const location = useLocation()\n\n  React.useEffect(() => {\n    if (!when) return\n\n    let unblock = location.history.block((transition) => {\n      if (window.confirm(message)) {\n        unblock()\n        transition.retry()\n      } else {\n        location.current.pathname = window.location.pathname\n      }\n    })\n\n    return unblock\n  }, [when, location, message])\n}\n\nexport function Prompt({ message, when, children }: PromptProps) {\n  usePrompt(message, when ?? true)\n  return (children ?? null) as React.ReactNode\n}\n\nfunction warning(cond: boolean, message: string) {\n  if (!cond) {\n    if (typeof console !== 'undefined') console.warn(message)\n\n    try {\n      throw new Error(message)\n    } catch {}\n  }\n}\n\nfunction isFunction(d: any): d is Function {\n  return typeof d === 'function'\n}\n\nexport function functionalUpdate<TResult>(\n  updater?: Updater<TResult>,\n  previous?: TResult,\n) {\n  if (isFunction(updater)) {\n    return updater(previous as TResult)\n  }\n\n  return updater\n}\n\nfunction joinPaths(paths: (string | undefined)[]) {\n  return cleanPath(paths.filter(Boolean).join('/'))\n}\n\nexport function cleanPath(path: string) {\n  // remove double slashes\n  return `${path}`.replace(/\\/{2,}/g, '/')\n}\n\nexport function matchByPath<\n  TGenerics extends PartialGenerics = DefaultGenerics,\n>(\n  currentLocation: Location<TGenerics>,\n  matchLocation: MatchLocation<TGenerics>,\n): UseGeneric<TGenerics, 'Params'> | undefined {\n  const baseSegments = parsePathname(currentLocation.pathname)\n  const routeSegments = parsePathname(`${matchLocation.to ?? '*'}`)\n\n  const params: Record<string, string> = {}\n\n  let isMatch = (() => {\n    for (\n      let i = 0;\n      i < Math.max(baseSegments.length, routeSegments.length);\n      i++\n    ) {\n      const baseSegment = baseSegments[i]\n      const routeSegment = routeSegments[i]\n\n      const isLastRouteSegment = i === routeSegments.length - 1\n      const isLastBaseSegment = i === baseSegments.length - 1\n\n      if (routeSegment) {\n        if (routeSegment.type === 'wildcard') {\n          if (baseSegment?.value) {\n            params['*'] = joinPaths(baseSegments.slice(i).map((d) => d.value))\n            return true\n          }\n          return false\n        }\n\n        if (routeSegment.type === 'pathname') {\n          if (routeSegment.value === '/' && !baseSegment?.value) {\n            return true\n          }\n\n          if (baseSegment) {\n            if (matchLocation.caseSensitive) {\n              if (routeSegment.value !== baseSegment.value) {\n                return false\n              }\n            } else if (\n              routeSegment.value.toLowerCase() !==\n              baseSegment.value.toLowerCase()\n            ) {\n              return false\n            }\n          }\n        }\n\n        if (!baseSegment) {\n          return false\n        }\n\n        if (routeSegment.type === 'param') {\n          params[routeSegment.value.substring(1)] = baseSegment.value\n        }\n      }\n\n      if (isLastRouteSegment && !isLastBaseSegment) {\n        return !!matchLocation.fuzzy\n      }\n    }\n    return true\n  })()\n\n  return isMatch ? (params as UseGeneric<TGenerics, 'Params'>) : undefined\n}\n\nfunction matchBySearch<TGenerics extends PartialGenerics = DefaultGenerics>(\n  currentLocation: Location<TGenerics>,\n  matchLocation: MatchLocation<TGenerics>,\n) {\n  return !!(\n    matchLocation.search && matchLocation.search(currentLocation.search)\n  )\n}\n\nexport function parsePathname(pathname?: string): Segment[] {\n  if (!pathname) {\n    return []\n  }\n\n  pathname = cleanPath(pathname)\n\n  const segments: Segment[] = []\n\n  if (pathname.slice(0, 1) === '/') {\n    pathname = pathname.substring(1)\n    segments.push({\n      type: 'pathname',\n      value: '/',\n    })\n  }\n\n  if (!pathname) {\n    return segments\n  }\n\n  // Remove empty segments and '.' segments\n  const split = pathname.split('/').filter(Boolean)\n\n  segments.push(\n    ...split.map((part): Segment => {\n      if (part.startsWith('*')) {\n        return {\n          type: 'wildcard',\n          value: part,\n        }\n      }\n\n      if (part.charAt(0) === ':') {\n        return {\n          type: 'param',\n          value: part,\n        }\n      }\n\n      return {\n        type: 'pathname',\n        value: part,\n      }\n    }),\n  )\n\n  if (pathname.slice(-1) === '/') {\n    pathname = pathname.substring(1)\n    segments.push({\n      type: 'pathname',\n      value: '/',\n    })\n  }\n\n  return segments\n}\n\nexport function resolvePath(basepath: string, base: string, to: string) {\n  base = base.replace(new RegExp(`^${basepath}`), '/')\n  to = to.replace(new RegExp(`^${basepath}`), '/')\n\n  let baseSegments = parsePathname(base)\n  const toSegments = parsePathname(to)\n\n  toSegments.forEach((toSegment, index) => {\n    if (toSegment.value === '/') {\n      if (!index) {\n        // Leading slash\n        baseSegments = [toSegment]\n      } else if (index === toSegments.length - 1) {\n        // Trailing Slash\n        baseSegments.push(toSegment)\n      } else {\n        // ignore inter-slashes\n      }\n    } else if (toSegment.value === '..') {\n      baseSegments.pop()\n    } else if (toSegment.value === '.') {\n      return\n    } else {\n      baseSegments.push(toSegment)\n    }\n  })\n\n  const joined = joinPaths([basepath, ...baseSegments.map((d) => d.value)])\n\n  return cleanPath(joined)\n}\n\nfunction isCtrlEvent(e: React.MouseEvent) {\n  return !!(e.metaKey || e.altKey || e.ctrlKey || e.shiftKey)\n}\n\nfunction useLatestCallback<TCallback extends (...args: any[]) => any>(\n  cb: TCallback,\n) {\n  const stableFnRef =\n    React.useRef<(...args: Parameters<TCallback>) => ReturnType<TCallback>>()\n  const cbRef = React.useRef<TCallback>(cb)\n\n  cbRef.current = cb\n\n  if (!stableFnRef.current) {\n    stableFnRef.current = (...args) => cbRef.current(...args)\n  }\n\n  return stableFnRef.current\n}\n\nfunction useGetIsMounted() {\n  const ref = React.useRef(false)\n\n  React.useEffect(() => {\n    ref.current = true\n\n    return () => {\n      ref.current = false\n    }\n  })\n\n  return () => ref.current\n}\n\n/**\n * This function returns `a` if `b` is deeply equal.\n * If not, it will replace any deeply equal children of `b` with those of `a`.\n * This can be used for structural sharing between JSON values for example.\n */\nfunction replaceEqualDeep(prev: any, next: any) {\n  if (prev === next) {\n    return prev\n  }\n\n  const array = Array.isArray(prev) && Array.isArray(next)\n\n  if (array || (isPlainObject(prev) && isPlainObject(next))) {\n    const aSize = array ? prev.length : Object.keys(prev).length\n    const bItems = array ? next : Object.keys(next)\n    const bSize = bItems.length\n    const copy: any = array ? [] : {}\n\n    let equalItems = 0\n\n    for (let i = 0; i < bSize; i++) {\n      const key = array ? i : bItems[i]\n      copy[key] = replaceEqualDeep(prev[key], next[key])\n      if (copy[key] === prev[key]) {\n        equalItems++\n      }\n    }\n\n    return aSize === bSize && equalItems === aSize ? prev : copy\n  }\n\n  return next\n}\n\n// Copied from: https://github.com/jonschlinkert/is-plain-object\nfunction isPlainObject(o: any) {\n  if (!hasObjectPrototype(o)) {\n    return false\n  }\n\n  // If has modified constructor\n  const ctor = o.constructor\n  if (typeof ctor === 'undefined') {\n    return true\n  }\n\n  // If has modified prototype\n  const prot = ctor.prototype\n  if (!hasObjectPrototype(prot)) {\n    return false\n  }\n\n  // If constructor does not have an Object-specific method\n  if (!prot.hasOwnProperty('isPrototypeOf')) {\n    return false\n  }\n\n  // Most likely a plain Object\n  return true\n}\n\nfunction hasObjectPrototype(o: any) {\n  return Object.prototype.toString.call(o) === '[object Object]'\n}\n\nexport const defaultParseSearch = parseSearchWith(JSON.parse)\nexport const defaultStringifySearch = stringifySearchWith(JSON.stringify)\n\nexport function parseSearchWith(parser: (str: string) => any) {\n  return (searchStr: string): Record<string, any> => {\n    if (searchStr.substring(0, 1) === '?') {\n      searchStr = searchStr.substring(1)\n    }\n\n    let query: Record<string, unknown> = decode(searchStr)\n\n    // Try to parse any query params that might be json\n    for (let key in query) {\n      const value = query[key]\n      if (typeof value === 'string') {\n        try {\n          query[key] = parser(value)\n        } catch (err) {\n          //\n        }\n      }\n    }\n\n    return query\n  }\n}\n\nexport function stringifySearchWith(stringify: (search: any) => string) {\n  return (search: Record<string, any>) => {\n    search = { ...search }\n\n    if (search) {\n      Object.keys(search).forEach((key) => {\n        const val = search[key]\n        if (typeof val === 'undefined' || val === undefined) {\n          delete search[key]\n        } else if (val && typeof val === 'object' && val !== null) {\n          try {\n            search[key] = stringify(val)\n          } catch (err) {\n            // silent\n          }\n        }\n      })\n    }\n\n    const searchStr = encode(search as Record<string, string>).toString()\n\n    return searchStr ? `?${searchStr}` : ''\n  }\n}\n"],"names":["encode","obj","pfx","k","i","tmp","str","Array","isArray","length","encodeURIComponent","toValue","mix","decodeURIComponent","decode","out","arr","split","shift","concat","LocationContext","React","createContext","MatchesContext","routerContext","isDOM","Boolean","window","document","createElement","useLayoutEffect","useEffect","createDefaultHistory","createBrowserHistory","createMemoryHistory","Subscribable","constructor","listeners","subscribe","listener","push","filter","x","notify","forEach","ReactLocation","options","isTransitioning","history","stringifySearch","defaultStringifySearch","parseSearch","defaultParseSearch","current","parseLocation","location","destroy","listen","event","buildNext","basepath","dest","from","pathname","resolvePath","to","filteredSearch","__searchFilters","reduce","prev","next","search","updatedSearch","functionalUpdate","replaceEqualDeep","searchStr","hash","href","key","navigate","replace","navigateTimeout","clearTimeout","nextAction","isSameUrl","previousLocation","parsedSearch","reverse","MatchesProvider","props","Router","children","__experimental__snapshot","rest","routerRef","useRef","RouterInstance","routes","router","nonce","rerender","useReducer","update","updateLocation","unsubscribe","rootMatch","state","matches","InitialSideEffects","useLocation","useBuildNext","useNavigate","fromCurrent","routesById","opts","Object","assign","cleanPath","recurseRoutes","parent","map","route","path","id","joinPaths","pendingMs","defaultPendingMs","pendingMinMs","defaultPendingMinMs","console","warn","Error","undefined","params","ownData","data","isLoading","status","setState","updater","newState","pending","cleanMatchCache","matchCache","activeMatchIds","d","values","match","updatedAt","includes","age","Date","now","maxAge","unloader","promise","Promise","resolve","matchLoader","MatchLoader","old","currentMatches","find","dd","onExit","onTransition","onMatch","loadData","startPending","__experimental__createSnapshot","index","cascadeMatchData","context","useContext","warning","RouteMatch","unloadedMatch","isSoft","preNotify","assignMatchLoader","pendingTimeout","setTimeout","pendingMinPromise","r","load","loaderMaxAge","defaultLoaderMaxAge","loaderPromise","importer","import","then","imported","elementPromises","elementTypes","type","routeElement","res","loader","dataPromise","resolveLoader","loaderReady","error","reject","err","parentMatch","dispatch","all","nextLocation","preNotifiedMatches","routeMatch","firstRenderPromises","unloadedMatches","matchRoutes","useRouter","value","currentLocation","recurse","filteredRoutes","filterRoutes","fullRoutePathName","fuzzy","matchParams","matchRoute","caseSensitive","interpolatedPath","interpolatePath","interpolatedId","leaveWildcard","interpolatedPathSegments","parsePathname","segment","substring","useLoadRoute","useMatch","useLatestCallback","useParentMatches","slice","findIndex","useMatches","Navigate","searchFilters","flat","Link","target","style","onClick","onMouseEnter","className","getActiveProps","getInactiveProps","activeOptions","preload","disabled","_ref","loadRoute","defaultLinkPreloadMaxAge","url","URL","e","handleClick","isCtrlEvent","defaultPrevented","button","preventDefault","handleMouseEnter","pathIsEqual","currentPathSplit","nextPathSplit","pathIsFuzzyEqual","every","hashIsEqual","pathTest","exact","hashTest","includeHash","isActive","activeStyle","activeClassName","activeRest","inactiveStyle","inactiveClassName","inactiveRest","ref","join","role","Outlet","_","errorElement","defaultErrorElement","element","useErrorBoundary","preStyle","whiteSpace","display","background","padding","margin","lineHeight","borderRadius","toString","pendingElement","defaultPendingElement","matchElement","defaultElement","useResolvePath","useSearch","matchLocation","pathParams","matchByPath","searchMatched","matchBySearch","useMatchRoute","MatchRoute","usePrompt","message","when","unblock","block","transition","confirm","retry","Prompt","cond","isFunction","previous","paths","baseSegments","routeSegments","isMatch","Math","max","baseSegment","routeSegment","isLastRouteSegment","isLastBaseSegment","toLowerCase","segments","part","startsWith","charAt","base","RegExp","toSegments","toSegment","pop","joined","metaKey","altKey","ctrlKey","shiftKey","cb","stableFnRef","cbRef","array","isPlainObject","aSize","keys","bItems","bSize","copy","equalItems","o","hasObjectPrototype","ctor","prot","prototype","hasOwnProperty","call","parseSearchWith","JSON","parse","stringifySearchWith","stringify","parser","query","val"],"mappings":"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"}