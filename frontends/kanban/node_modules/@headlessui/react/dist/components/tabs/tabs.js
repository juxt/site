import _,{Fragment as Z,createContext as G,useContext as j,useMemo as S,useReducer as ee,useRef as U}from"react";import{render as M,Features as V,forwardRefWithAs as F}from'../../utils/render.js';import{useId as J}from'../../hooks/use-id.js';import{match as Q}from'../../utils/match.js';import{Keys as T}from'../../components/keyboard.js';import{focusIn as L,Focus as b,sortByDomNode as X}from'../../utils/focus-management.js';import{useIsoMorphicEffect as W}from'../../hooks/use-iso-morphic-effect.js';import{useSyncRefs as v}from'../../hooks/use-sync-refs.js';import{useResolveButtonType as te}from'../../hooks/use-resolve-button-type.js';import{useLatestValue as N}from'../../hooks/use-latest-value.js';import{FocusSentinel as re}from'../../internal/focus-sentinel.js';import{useEvent as H}from'../../hooks/use-event.js';import{microTask as ne}from'../../utils/micro-task.js';var ae=(n=>(n[n.SetSelectedIndex=0]="SetSelectedIndex",n[n.RegisterTab=1]="RegisterTab",n[n.UnregisterTab=2]="UnregisterTab",n[n.RegisterPanel=3]="RegisterPanel",n[n.UnregisterPanel=4]="UnregisterPanel",n[n.ForceRerender=5]="ForceRerender",n))(ae||{});let le={[0](e,t){let r=e.tabs.filter(n=>{var l;return!((l=n.current)!=null&&l.hasAttribute("disabled"))});if(t.index<0)return{...e,selectedIndex:e.tabs.indexOf(r[0])};if(t.index>e.tabs.length)return{...e,selectedIndex:e.tabs.indexOf(r[r.length-1])};let s=e.tabs.slice(0,t.index),d=[...e.tabs.slice(t.index),...s].find(n=>r.includes(n));return d?{...e,selectedIndex:e.tabs.indexOf(d)}:e},[1](e,t){return e.tabs.includes(t.tab)?e:{...e,tabs:X([...e.tabs,t.tab],r=>r.current)}},[2](e,t){return{...e,tabs:X(e.tabs.filter(r=>r!==t.tab),r=>r.current)}},[3](e,t){return e.panels.includes(t.panel)?e:{...e,panels:[...e.panels,t.panel]}},[4](e,t){return{...e,panels:e.panels.filter(r=>r!==t.panel)}},[5](e){return{...e}}},B=G(null);B.displayName="TabsSSRContext";function K(e){let t=j(B);if(t===null){let r=new Error(`<${e} /> is missing a parent <Tab.Group /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(r,K),r}return t}let $=G(null);$.displayName="TabsDataContext";function C(e){let t=j($);if(t===null){let r=new Error(`<${e} /> is missing a parent <Tab.Group /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(r,C),r}return t}let z=G(null);z.displayName="TabsActionsContext";function q(e){let t=j(z);if(t===null){let r=new Error(`<${e} /> is missing a parent <Tab.Group /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(r,q),r}return t}function oe(e,t){return Q(t.type,le,e,t)}let se=Z,ie=F(function(t,r){let{defaultIndex:s=0,vertical:f=!1,manual:d=!1,onChange:n,selectedIndex:l=null,...P}=t;const p=f?"vertical":"horizontal",R=d?"manual":"auto";let i=l!==null,g=v(r),[u,o]=ee(oe,{selectedIndex:l!=null?l:s,tabs:[],panels:[]}),y=S(()=>({selectedIndex:u.selectedIndex}),[u.selectedIndex]),h=N(n||(()=>{})),x=N(u.tabs),m=S(()=>({orientation:p,activation:R,...u}),[p,R,u]),A=N(i?t.selectedIndex:u.selectedIndex),w=S(()=>({registerTab(c){return o({type:1,tab:c}),()=>o({type:2,tab:c})},registerPanel(c){return o({type:3,panel:c}),()=>o({type:4,panel:c})},forceRerender(){o({type:5})},change(c){A.current!==c&&h.current(c),i||o({type:0,index:c})}}),[o,i]);W(()=>{o({type:0,index:l!=null?l:s})},[l]);let O=U({tabs:[],panels:[]}),k={ref:g};return _.createElement(B.Provider,{value:O},_.createElement(z.Provider,{value:w},_.createElement($.Provider,{value:m},m.tabs.length<=0&&_.createElement(re,{onFocus:()=>{var c,I;for(let D of x.current)if(((c=D.current)==null?void 0:c.tabIndex)===0)return(I=D.current)==null||I.focus(),!0;return!1}}),M({ourProps:k,theirProps:P,slot:y,defaultTag:se,name:"Tabs"}))))}),ue="div",ce=F(function(t,r){let{orientation:s,selectedIndex:f}=C("Tab.List"),d=v(r);return M({ourProps:{ref:d,role:"tablist","aria-orientation":s},theirProps:t,slot:{selectedIndex:f},defaultTag:ue,name:"Tabs.List"})}),pe="button",de=F(function(t,r){var I,D;let s=`headlessui-tabs-tab-${J()}`,{orientation:f,activation:d,selectedIndex:n,tabs:l,panels:P}=C("Tab"),p=q("Tab"),R=K("Tab"),i=U(null),g=v(i,r,a=>{!a||requestAnimationFrame(()=>p.forceRerender())});W(()=>p.registerTab(i),[p,i]);let u=R.current.tabs.indexOf(s);u===-1&&(u=R.current.tabs.push(s)-1);let o=l.indexOf(i);o===-1&&(o=u);let y=o===n,h=H(a=>{let E=l.map(Y=>Y.current).filter(Boolean);if(a.key===T.Space||a.key===T.Enter){a.preventDefault(),a.stopPropagation(),p.change(o);return}switch(a.key){case T.Home:case T.PageUp:return a.preventDefault(),a.stopPropagation(),L(E,b.First);case T.End:case T.PageDown:return a.preventDefault(),a.stopPropagation(),L(E,b.Last)}if(Q(f,{vertical(){if(a.key===T.ArrowUp)return L(E,b.Previous|b.WrapAround);if(a.key===T.ArrowDown)return L(E,b.Next|b.WrapAround)},horizontal(){if(a.key===T.ArrowLeft)return L(E,b.Previous|b.WrapAround);if(a.key===T.ArrowRight)return L(E,b.Next|b.WrapAround)}}))return a.preventDefault()}),x=H(()=>{var a;(a=i.current)==null||a.focus()}),m=U(!1),A=H(()=>{var a;m.current||(m.current=!0,(a=i.current)==null||a.focus(),p.change(o),ne(()=>{m.current=!1}))}),w=H(a=>{a.preventDefault()}),O=S(()=>({selected:y}),[y]),k=t,c={ref:g,onKeyDown:h,onFocus:d==="manual"?x:A,onMouseDown:w,onClick:A,id:s,role:"tab",type:te(t,i),"aria-controls":(D=(I=P[o])==null?void 0:I.current)==null?void 0:D.id,"aria-selected":y,tabIndex:y?0:-1};return M({ourProps:c,theirProps:k,slot:O,defaultTag:pe,name:"Tabs.Tab"})}),fe="div",Te=F(function(t,r){let{selectedIndex:s}=C("Tab.Panels"),f=v(r),d=S(()=>({selectedIndex:s}),[s]);return M({ourProps:{ref:f},theirProps:t,slot:d,defaultTag:fe,name:"Tabs.Panels"})}),be="div",me=V.RenderStrategy|V.Static,Pe=F(function(t,r){var x,m;let{selectedIndex:s,tabs:f,panels:d}=C("Tab.Panel"),n=q("Tab.Panel"),l=K("Tab.Panel"),P=`headlessui-tabs-panel-${J()}`,p=U(null),R=v(p,r,A=>{!A||requestAnimationFrame(()=>n.forceRerender())});W(()=>n.registerPanel(p),[n,p]);let i=l.current.panels.indexOf(P);i===-1&&(i=l.current.panels.push(P)-1);let g=d.indexOf(p);g===-1&&(g=i);let u=g===s,o=S(()=>({selected:u}),[u]),y=t,h={ref:R,id:P,role:"tabpanel","aria-labelledby":(m=(x=f[g])==null?void 0:x.current)==null?void 0:m.id,tabIndex:u?0:-1};return M({ourProps:h,theirProps:y,slot:o,defaultTag:be,features:me,visible:u,name:"Tabs.Panel"})}),Ge=Object.assign(de,{Group:ie,List:ce,Panels:Te,Panel:Pe});export{Ge as Tab};
