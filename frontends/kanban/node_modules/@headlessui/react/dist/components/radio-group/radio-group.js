import g,{createContext as te,useContext as re,useMemo as C,useReducer as oe,useRef as j}from"react";import{forwardRefWithAs as V,render as J,compact as ie}from'../../utils/render.js';import{useId as q}from'../../hooks/use-id.js';import{match as ne}from'../../utils/match.js';import{useIsoMorphicEffect as B}from'../../hooks/use-iso-morphic-effect.js';import{Keys as O}from'../../components/keyboard.js';import{focusIn as Q,Focus as I,FocusResult as X,sortByDomNode as ae}from'../../utils/focus-management.js';import{useFlags as le}from'../../hooks/use-flags.js';import{Label as pe,useLabels as Y}from'../../components/label/label.js';import{Description as se,useDescriptions as Z}from'../../components/description/description.js';import{useTreeWalker as ue}from'../../hooks/use-tree-walker.js';import{useSyncRefs as z}from'../../hooks/use-sync-refs.js';import{Hidden as de,Features as ce}from'../../internal/hidden.js';import{attemptSubmit as fe,objectToFormEntries as Te}from'../../utils/form.js';import{getOwnerDocument as me}from'../../utils/owner.js';import{useEvent as b}from'../../hooks/use-event.js';import{useControllable as be}from'../../hooks/use-controllable.js';var ye=(t=>(t[t.RegisterOption=0]="RegisterOption",t[t.UnregisterOption=1]="UnregisterOption",t))(ye||{});let Re={[0](a,o){let t=[...a.options,{id:o.id,element:o.element,propsRef:o.propsRef}];return{...a,options:ae(t,l=>l.element.current)}},[1](a,o){let t=a.options.slice(),l=a.options.findIndex(v=>v.id===o.id);return l===-1?a:(t.splice(l,1),{...a,options:t})}},$=te(null);$.displayName="RadioGroupContext";function ee(a){let o=re($);if(o===null){let t=new Error(`<${a} /> is missing a parent <RadioGroup /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(t,ee),t}return o}function ge(a,o){return ne(o.type,Re,a,o)}let Oe="div",ve=V(function(o,t){let{value:l,defaultValue:v,name:c,onChange:S,by:P=(e,r)=>e===r,disabled:A=!1,..._}=o,u=b(typeof P=="string"?(e,r)=>{let n=P;return(e==null?void 0:e[n])===(r==null?void 0:r[n])}:P),[M,E]=oe(ge,{options:[]}),i=M.options,[y,U]=Y(),[f,D]=Z(),H=`headlessui-radiogroup-${q()}`,h=j(null),G=z(h,t),[p,k]=be(l,S,v),F=C(()=>i.find(e=>!e.propsRef.current.disabled),[i]),L=C(()=>i.some(e=>u(e.propsRef.current.value,p)),[i,p]),T=b(e=>{var n;if(A||u(e,p))return!1;let r=(n=i.find(w=>u(w.propsRef.current.value,e)))==null?void 0:n.propsRef.current;return r!=null&&r.disabled?!1:(k==null||k(e),!0)});ue({container:h.current,accept(e){return e.getAttribute("role")==="radio"?NodeFilter.FILTER_REJECT:e.hasAttribute("role")?NodeFilter.FILTER_SKIP:NodeFilter.FILTER_ACCEPT},walk(e){e.setAttribute("role","none")}});let N=b(e=>{let r=h.current;if(!r)return;let n=me(r),w=i.filter(d=>d.propsRef.current.disabled===!1).map(d=>d.element.current);switch(e.key){case O.Enter:fe(e.currentTarget);break;case O.ArrowLeft:case O.ArrowUp:if(e.preventDefault(),e.stopPropagation(),Q(w,I.Previous|I.WrapAround)===X.Success){let m=i.find(K=>K.element.current===(n==null?void 0:n.activeElement));m&&T(m.propsRef.current.value)}break;case O.ArrowRight:case O.ArrowDown:if(e.preventDefault(),e.stopPropagation(),Q(w,I.Next|I.WrapAround)===X.Success){let m=i.find(K=>K.element.current===(n==null?void 0:n.activeElement));m&&T(m.propsRef.current.value)}break;case O.Space:{e.preventDefault(),e.stopPropagation();let d=i.find(m=>m.element.current===(n==null?void 0:n.activeElement));d&&T(d.propsRef.current.value)}break}}),x=b(e=>(E({type:0,...e}),()=>E({type:1,id:e.id}))),s=C(()=>({registerOption:x,firstOption:F,containsCheckedOption:L,change:T,disabled:A,value:p,compare:u}),[x,F,L,T,A,p,u]),R={ref:G,id:H,role:"radiogroup","aria-labelledby":y,"aria-describedby":f,onKeyDown:N},W=C(()=>({value:p}),[p]);return g.createElement(D,{name:"RadioGroup.Description"},g.createElement(U,{name:"RadioGroup.Label"},g.createElement($.Provider,{value:s},c!=null&&p!=null&&Te({[c]:p}).map(([e,r])=>g.createElement(de,{features:ce.Hidden,...ie({key:e,as:"input",type:"radio",checked:r!=null,hidden:!0,readOnly:!0,name:e,value:r})})),J({ourProps:R,theirProps:_,slot:W,defaultTag:Oe,name:"RadioGroup"}))))});var Pe=(t=>(t[t.Empty=1]="Empty",t[t.Active=2]="Active",t))(Pe||{});let Ae="div",Ee=V(function(o,t){let l=j(null),v=z(l,t),c=`headlessui-radiogroup-option-${q()}`,[S,P]=Y(),[A,_]=Z(),{addFlag:u,removeFlag:M,hasFlag:E}=le(1),{value:i,disabled:y=!1,...U}=o,f=j({value:i,disabled:y});B(()=>{f.current.value=i},[i,f]),B(()=>{f.current.disabled=y},[y,f]);let{registerOption:D,disabled:H,change:h,firstOption:G,containsCheckedOption:p,value:k,compare:F}=ee("RadioGroup.Option");B(()=>D({id:c,element:l,propsRef:f}),[c,D,l,o]);let L=b(()=>{var r;!h(i)||(u(2),(r=l.current)==null||r.focus())}),T=b(()=>u(2)),N=b(()=>M(2)),x=(G==null?void 0:G.id)===c,s=H||y,R=F(k,i),W={ref:v,id:c,role:"radio","aria-checked":R?"true":"false","aria-labelledby":S,"aria-describedby":A,"aria-disabled":s?!0:void 0,tabIndex:(()=>s?-1:R||!p&&x?0:-1)(),onClick:s?void 0:L,onFocus:s?void 0:T,onBlur:s?void 0:N},e=C(()=>({checked:R,disabled:s,active:E(2)}),[R,s,E]);return g.createElement(_,{name:"RadioGroup.Description"},g.createElement(P,{name:"RadioGroup.Label"},J({ourProps:W,theirProps:U,slot:e,defaultTag:Ae,name:"RadioGroup.Option"})))}),Xe=Object.assign(ve,{Option:Ee,Label:pe,Description:se});export{Xe as RadioGroup};
