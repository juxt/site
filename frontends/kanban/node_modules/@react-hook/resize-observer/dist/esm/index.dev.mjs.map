{"version":3,"file":"index.dev.mjs","sources":["../../src/index.tsx"],"sourcesContent":["/* eslint-disable no-return-assign */\n/* eslint-disable no-underscore-dangle */\nimport * as React from 'react'\nimport {\n  ResizeObserver as Polyfill,\n  ResizeObserverEntry,\n} from '@juggle/resize-observer'\nimport useLayoutEffect from '@react-hook/passive-layout-effect'\nimport useLatest from '@react-hook/latest'\n\nconst ResizeObserver =\n  typeof window !== 'undefined' && 'ResizeObserver' in window\n    ? // @ts-ignore\n      window.ResizeObserver\n    : Polyfill\n\n/**\n * A React hook that fires a callback whenever ResizeObserver detects a change to its size\n *\n * @param target A React ref created by `useRef()` or an HTML element\n * @param callback Invoked with a single `ResizeObserverEntry` any time\n *   the `target` resizes\n */\nfunction useResizeObserver<T extends HTMLElement>(\n  target: React.RefObject<T> | T | null,\n  callback: UseResizeObserverCallback\n): Polyfill {\n  const resizeObserver = getResizeObserver()\n  const storedCallback = useLatest(callback)\n\n  useLayoutEffect(() => {\n    let didUnsubscribe = false\n    const targetEl = target && 'current' in target ? target.current : target\n    if (!targetEl) return () => {}\n\n    function cb(entry: ResizeObserverEntry, observer: Polyfill) {\n      if (didUnsubscribe) return\n      storedCallback.current(entry, observer)\n    }\n\n    resizeObserver.subscribe(targetEl as HTMLElement, cb)\n\n    return () => {\n      didUnsubscribe = true\n      resizeObserver.unsubscribe(targetEl as HTMLElement, cb)\n    }\n  }, [target, resizeObserver, storedCallback])\n\n  return resizeObserver.observer\n}\n\nfunction createResizeObserver() {\n  let ticking = false\n  let allEntries: ResizeObserverEntry[] = []\n\n  const callbacks: Map<any, Array<UseResizeObserverCallback>> = new Map()\n\n  const observer = new ResizeObserver(\n    (entries: ResizeObserverEntry[], obs: Polyfill) => {\n      allEntries = allEntries.concat(entries)\n      if (!ticking) {\n        window.requestAnimationFrame(() => {\n          const triggered = new Set<Element>()\n          for (let i = 0; i < allEntries.length; i++) {\n            if (triggered.has(allEntries[i].target)) continue\n            triggered.add(allEntries[i].target)\n            const cbs = callbacks.get(allEntries[i].target)\n            cbs?.forEach((cb) => cb(allEntries[i], obs))\n          }\n          allEntries = []\n          ticking = false\n        })\n      }\n      ticking = true\n    }\n  )\n\n  return {\n    observer,\n    subscribe(target: HTMLElement, callback: UseResizeObserverCallback) {\n      observer.observe(target)\n      const cbs = callbacks.get(target) ?? []\n      cbs.push(callback)\n      callbacks.set(target, cbs)\n    },\n    unsubscribe(target: HTMLElement, callback: UseResizeObserverCallback) {\n      const cbs = callbacks.get(target) ?? []\n      if (cbs.length === 1) {\n        observer.unobserve(target)\n        callbacks.delete(target)\n        return\n      }\n      const cbIndex = cbs.indexOf(callback)\n      if (cbIndex !== -1) cbs.splice(cbIndex, 1)\n      callbacks.set(target, cbs)\n    },\n  }\n}\n\nlet _resizeObserver: ReturnType<typeof createResizeObserver>\n\nconst getResizeObserver = () =>\n  !_resizeObserver\n    ? (_resizeObserver = createResizeObserver())\n    : _resizeObserver\n\nexport type UseResizeObserverCallback = (\n  entry: ResizeObserverEntry,\n  observer: Polyfill\n) => any\n\nexport default useResizeObserver\n"],"names":["ResizeObserver","window","Polyfill","useResizeObserver","target","callback","resizeObserver","getResizeObserver","storedCallback","useLatest","useLayoutEffect","didUnsubscribe","targetEl","current","cb","entry","observer","subscribe","unsubscribe","createResizeObserver","ticking","allEntries","callbacks","Map","entries","obs","concat","triggered","Set","i","has","add","cbs","get","forEach","length","requestAnimationFrame","observe","push","set","unobserve","delete","cbIndex","indexOf","splice","_resizeObserver"],"mappings":"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"}