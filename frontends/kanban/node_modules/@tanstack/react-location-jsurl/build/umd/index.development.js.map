{"version":3,"file":"index.development.js","sources":["../../src/jsurl.ts","../../src/index.tsx"],"sourcesContent":["// We're inlining our own version of qss here for compression's sake, but we've included it as a hard dependency for the MIT license it requires.\n// Types are naive, but at least it compiles!\n\n// Unreserved characters for URL encoding are: - . _ ~\n// Earlier versions of this library used a different encoding for strings, but in our version we use a period for the string delimiter.\nconst previousStringPrefixes = [\"'\"] as const\nconst stringPrefix = '-'\n\nexport function stringify(v: any): string {\n  function encode(s: any) {\n    return !/[^\\w-.]/.test(s)\n      ? s\n      : s.replace(/[^\\w-.]/g, function (ch: any) {\n          if (ch === '$') return '!'\n          ch = ch.charCodeAt(0)\n          // thanks to Douglas Crockford for the negative slice trick\n          return ch < 0x100\n            ? '*' + ('00' + ch.toString(16)).slice(-2)\n            : '**' + ('0000' + ch.toString(16)).slice(-4)\n        })\n  }\n\n  var tmpAry\n\n  switch (typeof v) {\n    case 'number':\n      return isFinite(v) ? '~' + v : '~null'\n    case 'boolean':\n      return '~' + v\n    case 'string':\n      return '~' + stringPrefix + encode(v)\n    case 'object':\n      if (!v) return '~null'\n\n      tmpAry = []\n\n      if (Array.isArray(v)) {\n        for (var i = 0; i < v.length; i++) {\n          tmpAry[i] = stringify(v[i]!) || '~null'\n        }\n\n        return '~(' + (tmpAry.join('') || '~') + ')'\n      } else {\n        for (var key in v) {\n          if (v.hasOwnProperty(key)) {\n            var val = stringify(v[key]!)\n\n            // skip undefined and functions\n            if (val) {\n              tmpAry.push(encode(key) + val)\n            }\n          }\n        }\n\n        return '~(' + tmpAry.join('~') + ')'\n      }\n    default:\n      // function, undefined\n      return ''\n  }\n}\n\nvar reserved: Record<string, boolean | null> = {\n  true: true,\n  false: false,\n  null: null,\n} as const\n\nexport function parse(s: string): unknown {\n  if (!s) return s\n  s = s.replace(/%(25)*27/g, \"'\")\n  var i = 0,\n    len = s.length\n\n  function eat(expected: any) {\n    if (s.charAt(i) !== expected) {\n      // throw new Error(\n      //   'bad JSURL syntax: expected ' +\n      //     expected +\n      //     ', got ' +\n      //     (s && s.charAt(i)),\n      // )\n      throw new Error()\n    }\n    i++\n  }\n\n  function decode() {\n    var beg = i,\n      ch,\n      r = ''\n    while (i < len && (ch = s.charAt(i)) !== '~' && ch !== ')') {\n      switch (ch) {\n        case '*':\n          if (beg < i) r += s.substring(beg, i)\n          if (s.charAt(i + 1) === '*')\n            (r += String.fromCharCode(parseInt(s.substring(i + 2, i + 6), 16))),\n              (beg = i += 6)\n          else\n            (r += String.fromCharCode(parseInt(s.substring(i + 1, i + 3), 16))),\n              (beg = i += 3)\n          break\n        case '!':\n          if (beg < i) r += s.substring(beg, i)\n          ;(r += '$'), (beg = ++i)\n          break\n        default:\n          i++\n      }\n    }\n    return r + s.substring(beg, i)\n  }\n\n  return (function parseOne(): any {\n    var result: any, ch, beg\n    eat('~')\n    const current = (ch = s.charAt(i))\n    if (current === '(') {\n      i++\n      if (s.charAt(i) === '~') {\n        result = []\n        if (s.charAt(i + 1) === ')') i++\n        else {\n          do {\n            result.push(parseOne())\n          } while (s.charAt(i) === '~')\n        }\n      } else {\n        result = {}\n        if (s.charAt(i) !== ')') {\n          do {\n            var key = decode()\n            result[key] = parseOne()\n          } while (s.charAt(i) === '~' && ++i)\n        }\n      }\n      eat(')')\n    } else if ([stringPrefix, ...previousStringPrefixes].includes(current)) {\n      i++\n      result = decode()\n    } else {\n      beg = i++\n      while (i < len && /[^)~]/.test(s.charAt(i))) i++\n      var sub: string = s.substring(beg, i)\n      if (/[\\d\\-]/.test(ch)) {\n        result = parseFloat(sub)\n      } else {\n        result = reserved[sub]\n        if (typeof result === 'undefined') {\n          // throw new Error('bad value keyword: ' + sub)\n          throw new Error()\n        }\n      }\n    }\n    return result\n  })()\n}\n\nexport function tryParse<T>(s: string, def: any): unknown | T {\n  try {\n    return parse(s)\n  } catch (ex) {\n    return def\n  }\n}\n","import { parseSearchWith, stringifySearchWith } from '@tanstack/react-location'\nimport { stringify, parse } from './jsurl'\n\nexport function stringifySearch(search: Record<string, unknown>) {\n  return stringifySearchWith(stringify)(search)\n}\n\nexport function parseSearch(searchStr: string) {\n  return parseSearchWith(parse)(searchStr)\n}\n"],"names":["previousStringPrefixes","stringPrefix","stringify","v","encode","s","test","replace","ch","charCodeAt","toString","slice","tmpAry","isFinite","Array","isArray","i","length","join","key","hasOwnProperty","val","push","reserved","parse","len","eat","expected","charAt","Error","decode","beg","r","substring","String","fromCharCode","parseInt","parseOne","result","current","includes","sub","parseFloat","stringifySearch","search","stringifySearchWith","parseSearch","searchStr","parseSearchWith"],"mappings":"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"}