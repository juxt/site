{"version":3,"file":"index.js","sources":["../src/keymap.js"],"sourcesContent":["import {base, keyName} from \"w3c-keyname\"\nimport {Plugin} from \"prosemirror-state\"\n\n// declare global: navigator\n\nconst mac = typeof navigator != \"undefined\" ? /Mac|iP(hone|[oa]d)/.test(navigator.platform) : false\n\nfunction normalizeKeyName(name) {\n  let parts = name.split(/-(?!$)/), result = parts[parts.length - 1]\n  if (result == \"Space\") result = \" \"\n  let alt, ctrl, shift, meta\n  for (let i = 0; i < parts.length - 1; i++) {\n    let mod = parts[i]\n    if (/^(cmd|meta|m)$/i.test(mod)) meta = true\n    else if (/^a(lt)?$/i.test(mod)) alt = true\n    else if (/^(c|ctrl|control)$/i.test(mod)) ctrl = true\n    else if (/^s(hift)?$/i.test(mod)) shift = true\n    else if (/^mod$/i.test(mod)) { if (mac) meta = true; else ctrl = true }\n    else throw new Error(\"Unrecognized modifier name: \" + mod)\n  }\n  if (alt) result = \"Alt-\" + result\n  if (ctrl) result = \"Ctrl-\" + result\n  if (meta) result = \"Meta-\" + result\n  if (shift) result = \"Shift-\" + result\n  return result\n}\n\nfunction normalize(map) {\n  let copy = Object.create(null)\n  for (let prop in map) copy[normalizeKeyName(prop)] = map[prop]\n  return copy\n}\n\nfunction modifiers(name, event, shift) {\n  if (event.altKey) name = \"Alt-\" + name\n  if (event.ctrlKey) name = \"Ctrl-\" + name\n  if (event.metaKey) name = \"Meta-\" + name\n  if (shift !== false && event.shiftKey) name = \"Shift-\" + name\n  return name\n}\n\n// :: (Object) → Plugin\n// Create a keymap plugin for the given set of bindings.\n//\n// Bindings should map key names to [command](#commands)-style\n// functions, which will be called with `(EditorState, dispatch,\n// EditorView)` arguments, and should return true when they've handled\n// the key. Note that the view argument isn't part of the command\n// protocol, but can be used as an escape hatch if a binding needs to\n// directly interact with the UI.\n//\n// Key names may be strings like `\"Shift-Ctrl-Enter\"`—a key\n// identifier prefixed with zero or more modifiers. Key identifiers\n// are based on the strings that can appear in\n// [`KeyEvent.key`](https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent/key).\n// Use lowercase letters to refer to letter keys (or uppercase letters\n// if you want shift to be held). You may use `\"Space\"` as an alias\n// for the `\" \"` name.\n//\n// Modifiers can be given in any order. `Shift-` (or `s-`), `Alt-` (or\n// `a-`), `Ctrl-` (or `c-` or `Control-`) and `Cmd-` (or `m-` or\n// `Meta-`) are recognized. For characters that are created by holding\n// shift, the `Shift-` prefix is implied, and should not be added\n// explicitly.\n//\n// You can use `Mod-` as a shorthand for `Cmd-` on Mac and `Ctrl-` on\n// other platforms.\n//\n// You can add multiple keymap plugins to an editor. The order in\n// which they appear determines their precedence (the ones early in\n// the array get to dispatch first).\nexport function keymap(bindings) {\n  return new Plugin({props: {handleKeyDown: keydownHandler(bindings)}})\n}\n\n// :: (Object) → (view: EditorView, event: dom.Event) → bool\n// Given a set of bindings (using the same format as\n// [`keymap`](#keymap.keymap)), return a [keydown\n// handler](#view.EditorProps.handleKeyDown) that handles them.\nexport function keydownHandler(bindings) {\n  let map = normalize(bindings)\n  return function(view, event) {\n    let name = keyName(event), isChar = name.length == 1 && name != \" \", baseName\n    let direct = map[modifiers(name, event, !isChar)]\n    if (direct && direct(view.state, view.dispatch, view)) return true\n    if (isChar && (event.shiftKey || event.altKey || event.metaKey || name.charCodeAt(0) > 127) &&\n        (baseName = base[event.keyCode]) && baseName != name) {\n      // Try falling back to the keyCode when there's a modifier\n      // active or the character produced isn't ASCII, and our table\n      // produces a different name from the the keyCode. See #668,\n      // #1060\n      let fromCode = map[modifiers(baseName, event, true)]\n      if (fromCode && fromCode(view.state, view.dispatch, view)) return true\n    } else if (isChar && event.shiftKey) {\n      // Otherwise, if shift is active, also try the binding with the\n      // Shift- prefix enabled. See #997\n      let withShift = map[modifiers(name, event, true)]\n      if (withShift && withShift(view.state, view.dispatch, view)) return true\n    }\n    return false\n  }\n}\n"],"names":["const","let","Plugin","keyName","base"],"mappings":"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"}